

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>API Documentation &mdash; xpdAcq 0.6.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="xpdAcq 0.6.1 documentation" href="index.html"/>
        <link rel="next" title="For Beamline Staff" href="beamlinestaff.html"/>
        <link rel="prev" title="xpdAcq Configuration" href="usb_GlobalOptions.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> xpdAcq
          

          
          </a>

          
            
            
              <div class="version">
                0.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="xpdusers.html">For XPD Users</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#run-calibration-api-documentation">run_calibration API Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xrun-api-documentation">xrun API Documentation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="beamlinestaff.html">For Beamline Staff</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_note.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">xpdAcq</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>API Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/api_doc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="api-documentation">
<h1>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="run-calibration-api-documentation">
<span id="calib-api"></span><h2>run_calibration API Documentation<a class="headerlink" href="#run-calibration-api-documentation" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="xpdacq.calib.run_calibration">
<code class="descclassname">xpdacq.calib.</code><code class="descname">run_calibration</code><span class="sig-paren">(</span><em>exposure=5</em>, <em>dark_sub_bool=True</em>, <em>calibrant=None</em>, <em>phase_info=None</em>, <em>wavelength=None</em>, <em>detector=None</em>, <em>*</em>, <em>RE_instance=None</em>, <em>parallel=True</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#xpdacq.calib.run_calibration" title="Permalink to this definition">¶</a></dt>
<dd><p>function to run entire calibration process.</p>
<p>Entire process includes:</p>
<ol class="arabic simple">
<li>collect calibration image,</li>
<li>trigger pyFAI interactive calibration process,</li>
<li>store calibration parameters as a yaml file</li>
</ol>
<p>calibration parameters will be saved under xpdUser/config_base/
and this set of parameters will be injected as metadata to
subsequent scans until you perform this process again</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>exposure</strong> (<em>int</em><em>, </em><em>optional</em>) – total exposure time in sec. default is 5s</li>
<li><strong>dark_sub_bool</strong> (<em>bool</em><em>, </em><em>optional</em>) – option of turn on/off dark subtraction on this calibration
image. default is True.</li>
<li><strong>calibrant</strong> (<em>str</em><em>, </em><em>optional</em>) – calibrant being used, default is ‘Ni’.
input could be full file path to customized d-spacing file with
“.D” extension or one of pre-defined calibrant names.
List of pre-defined calibrant names is:
[‘NaCl’, ‘AgBh’, ‘quartz’, ‘Si_SRM640’, ‘Ni’, ‘Si_SRM640d’,
‘Si_SRM640a’, ‘alpha_Al2O3’, ‘LaB6_SRM660b’, ‘TiO2’, ‘CrOx’,
‘LaB6_SRM660c’, ‘CeO2’, ‘Si_SRM640c’, ‘CuO’, ‘Si_SRM640e’,
‘PBBA’, ‘ZnO’, ‘Si’, ‘C14H30O’, ‘cristobaltite’, ‘LaB6_SRM660a’,
‘Au’, ‘Cr2O3’, ‘Si_SRM640b’, ‘LaB6’, ‘Al’, ‘mock’]</li>
<li><strong>phase_info</strong> (<em>str</em><em>, </em><em>optional</em>) – phase infomation of calibrant, which is required to data
reduction process. This field will be parsed with the same logic
as the one used in parsing spreadsheet information. For detailed
information, please visit:
<a class="reference external" href="http://xpdacq.github.io/usb_Running.html#phase-string">http://xpdacq.github.io/usb_Running.html#phase-string</a>
If both <code class="docutils literal"><span class="pre">calibrant</span></code> and <code class="docutils literal"><span class="pre">phase_info</span></code> arguments are not provided,
this field will be defaulted to <code class="docutils literal"><span class="pre">Ni</span></code>.</li>
<li><strong>wavelength</strong> (<em>float</em><em>, </em><em>optional</em>) – x-ray wavelength in angstrom. default to value stored in
existing Beamtime object</li>
<li><strong>detector</strong> (<em>str</em><em> or </em><em>pyFAI.detector.Detector instance</em><em>, </em><em>optional.</em>) – detector used to collect data. default value is ‘perkin-elmer’.
other allowed values are in pyFAI documentation.</li>
<li><strong>RE_instance</strong> (<em>bluesky.run_engine.RunEngine instance</em><em>, </em><em>optional</em>) – instance of run engine. Default is xrun. Do not change under
normal circumstances.</li>
<li><strong>parallel</strong> (<em>bool</em><em>, </em><em>optional</em>) – Tag for whether run the calibration step in a separte
process. Running in parallel in principle yields better resource
allocation. Default is <code class="docutils literal"><span class="pre">True</span></code>, only change to <code class="docutils literal"><span class="pre">False</span></code> if
error is raised.</li>
<li><strong>kwargs</strong> – Additional keyword argument for calibration. please refer to
pyFAI documentation for all options.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Details about peak-picking gui from pyFAI documentaion</p>
<blockquote class="last">
<div><a class="reference external" href="http://pyfai.readthedocs.io/en/latest/usage/cookbook/calibrate.html#start-pyfai-calibration_md">http://pyfai.readthedocs.io/en/latest/usage/cookbook/calibrate.html#start-pyfai-calibration_md</a></div></blockquote>
</div>
</dd></dl>

</div>
<div class="section" id="xrun-api-documentation">
<span id="xrun-api"></span><h2>xrun API Documentation<a class="headerlink" href="#xrun-api-documentation" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="xpdacq.xpdacq.CustomizedRunEngine">
<em class="property">class </em><code class="descclassname">xpdacq.xpdacq.</code><code class="descname">CustomizedRunEngine</code><span class="sig-paren">(</span><em>beamtime</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#xpdacq.xpdacq.CustomizedRunEngine" title="Permalink to this definition">¶</a></dt>
<dd><p>A RunEngine customized for XPD workflows.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>beamtime</strong> (<em>xpdacq.beamtime.Beamtime</em><em> or </em><em>None</em>) – beamtime object that will be linked to. This beamtime object
provide reference of sample and scanplan indicies. If no
beamtime object is linked, index-based syntax will not be allowed.</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="xpdacq.xpdacq.CustomizedRunEngine.beamtime">
<code class="descname">beamtime</code><a class="headerlink" href="#xpdacq.xpdacq.CustomizedRunEngine.beamtime" title="Permalink to this definition">¶</a></dt>
<dd><p>beamtime object currently associated with this RunEngine instance.</p>
</dd></dl>

<p class="rubric">Examples</p>
<p>Basic usage: run samples and plans by number</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xrun</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Advanced usage: use custom plan which is compatible with bluesky</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xrun</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">custom_plan</span><span class="p">)</span>  <span class="c1"># sample 3, an arbitrary bluesky plan</span>
</pre></div>
</div>
<p>Or custom sample info. sample just has to be dict-like
and contain the required keys.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xrun</span><span class="p">(</span><span class="n">custom_sample_dict</span><span class="p">,</span> <span class="n">custom_plan</span><span class="p">)</span>
</pre></div>
</div>
<p>Or use completely custom dark frame logic</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xrun</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">custom_plan</span><span class="p">,</span> <span class="n">dark_strategy</span><span class="o">=</span><span class="n">some_custom_func</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="xpdacq.xpdacq.CustomizedRunEngine.__call__">
<code class="descname">__call__</code><span class="sig-paren">(</span><em>sample</em>, <em>plan</em>, <em>subs=None</em>, <em>*</em>, <em>verify_write=False</em>, <em>dark_strategy=&lt;function periodic_dark&gt;</em>, <em>**metadata_kw</em><span class="sig-paren">)</span><a class="headerlink" href="#xpdacq.xpdacq.CustomizedRunEngine.__call__" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a plan</p>
<p>Any keyword arguments other than those listed below will
be interpreted as metadata and recorded with the run.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sample</strong> (<em>int</em><em> or </em><em>dict-like</em>) – Sample metadata. If a beamtime object is linked,
an integer will be interpreted as the index appears in the
<code class="docutils literal"><span class="pre">bt.list()</span></code> method, corresponding metadata will be passed.
A customized dict can also be passed as the sample
metadata.</li>
<li><strong>plan</strong> (<em>int</em><em> or </em><em>generator</em>) – Scan plan. If a beamtime object is linked, an integer
will be interpreted as the index appears in the
<code class="docutils literal"><span class="pre">bt.list()</span></code> method, corresponding scan plan will be
A generator or that yields <code class="docutils literal"><span class="pre">Msg</span></code> objects (or an iterable
that returns such a generator) can also be passed.</li>
<li><strong>subs</strong> (<em>callable</em><em>, </em><em>list</em><em>, or </em><em>dict</em><em>, </em><em>optional</em>) – <p>Temporary subscriptions (a.k.a. callbacks) to be used on
this run. Default to None. For convenience, any of the
following are accepted:</p>
<ul>
<li>a callable, which will be subscribed to ‘all’</li>
<li>a list of callables, which again will be subscribed to ‘all’</li>
<li>a dictionary, mapping specific subscriptions to callables or
lists of callables; valid keys are {‘all’, ‘start’, ‘stop’,
‘event’, ‘descriptor’}</li>
</ul>
</li>
<li><strong>verify_write</strong> (<em>bool</em><em>, </em><em>optional</em>) – Double check if the data have been written into database.
In general data is written in a lossless fashion at the
NSLS-II. Therefore, False by default.</li>
<li><strong>dark_strategy</strong> (<em>callable</em><em>, </em><em>optional.</em>) – Protocol of taking dark frame during experiment. Default
to the logic of matching dark frame and light frame with
the sample exposure time and frame rate. Details can be
found at <code class="docutils literal"><span class="pre">http://xpdacq.github.io/xpdAcq/usb_Running.html#automated-dark-collection</span></code></li>
<li><strong>metadata_kw</strong> – Extra keyword arguments for specifying metadata in the
run time. If the extra metdata has the same key as the
<code class="docutils literal"><span class="pre">sample</span></code>, <code class="docutils literal"><span class="pre">ValueError</span></code> will be raised.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>uids</strong> – list of uids (i.e. RunStart Document uids) of run(s)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="beamlinestaff.html" class="btn btn-neutral float-right" title="For Beamline Staff" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="usb_GlobalOptions.html" class="btn btn-neutral" title="xpdAcq Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright (c) 2016 trustees of Columbia University in the City of New York.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.6.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>